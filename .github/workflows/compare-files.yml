name: Compare Files Without Duplicates

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  compare-files:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Compare files with clean output
      run: |
        {
          echo "🔍 Hasil Perbandingan ip.txt vs 2024.txt"
          echo "========================================"
          echo ""
          
          if cmp -s ip.txt 2024.txt; then
            echo "✅ Kedua file identik"
          else
            # Menghitung perbedaan unik (tanpa duplikat)
            differences=$(diff -u ip.txt 2024.txt | grep -E '^\+[^+]|^\-[^-]' | uniq)
            
            echo "❌ Ditemukan perbedaan:"
            echo ""
            echo "📋 Perubahan Unik:"
            echo "------------------"
            echo "$differences"
            echo ""
            
            echo "📊 Statistik File:"
            echo "ip.txt   : $(wc -l < ip.txt) baris"
            echo "2024.txt : $(wc -l < 2024.txt) baris"
          fi
        } > output.txt

        # Preview hasil
        echo "🔄 Hasil perbandingan tersimpan di output.txt:"
        cat output.txt

    - name: Commit and push result
      if: always()
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add output.txt
        git diff --cached --quiet || git commit -m "[Auto] Update hasil perbandingan"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
